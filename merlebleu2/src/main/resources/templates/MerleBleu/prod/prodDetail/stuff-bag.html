<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홈쇼핑 2팀</title>
    <link
            href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Playfair+Display:wght@400;700&display=swap"
            rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">
    <link rel="stylesheet" type="text/css" th:href="@{/css/css.css}">

</head>

<body>
<div class="outer-wrap">
    <form id="searchForm1" onsubmit="redirectToSearch1(); return false;">
        <div class="main_wrap">
            <div class="header_content gna">
                <div th:replace="~{fragments/header::header}"></div>
            </div>
            <div class="mySlides fade">
            </div>
        </div>
        <div style="text-align:center; margin-top: -210px;">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
</div>
</form>

<form id="searchForm2" onsubmit="handleSearch(); return false;">
    <div class="cate_box5 cate_box_child10" onmouseover="cateHover('cate_box_child10')" onmouseout="cateOut()">
        <div class="wrap_nav2">
            <div class="box_cont_wrap2" style="margin-left: 50%;">
                <div id="input-form" style="margin: 0 auto;" class="search_input">
                    <input autocomplete="off" class="search_input_detail" type="text" id="searchKeyword2"
                           placeholder="검색어를 입력하세요" style="padding: 15px;">
                    <button class="search_button" type="submit" onclick="handleSearch()">검색</button>
                    <p style="margin-bottom: -15px;" class="error-message" id="errorMessage2"></p>
                </div>
            </div>
        </div>
        <div class="kategory2">
            <ul>
                <h3>카테고리 검색</h3>
                <li><a href="./search_outer#">#아우터</a></li>
                <li><a href="./search_top#">#탑</a></li>
                <li><a href="./search_skirt#">#스커트</a></li>
                <li><a href="./search_pants#">#팬츠</a></li>
                <li><a href="./search_onepiece#">#원피스</a></li>
                <li><a href="./search_stuff#">#패션잡화</a></li>
            </ul>
        </div>
        <div class="srch_keyword_box">
            <div class="recent_keyword">
                <h3>최근 검색어</h3>
                <a class="delete" onclick="allDeleteCookie()" style="cursor: pointer;">전체삭제</a>
                <ul id="recentSearchList">
                </ul>
            </div>
        </div>
    </div>
</form>


<!--===========================================================================================================================================-->
<!--===========================================================================================================================================-->
<!--===========================================================================================================================================-->
<!--===========================================================================================================================================-->
<!--===========================================================================================================================================-->
<!--===========================================================================================================================================-->

</div>
<div class="outer-wrap2">
    <div class="outer-main-wrap">
        <div class="outer-link-wrap">
            <div class="outer-link-content">
                <ul>
                    <a href="./search_stuff#" class="outer-click-total">
                        <li>전체보기</li>
                    </a>
                    <a href="./stuff-bag#">
                        <li>#가방</li>
                    </a>
                    <a href="./stuff-shoes#">
                        <li>#슈즈</li>
                    </a>
                    <a href="./stuff-hat#">
                        <li>#모자</li>
                    </a>
                    <a href="./stuff-scarf#">
                        <li>#스카프/머플러</li>
                    </a>
                    <a href="./stuff-belt#">
                        <li>#벨트</li>
                    </a>
                    <a href="./stuff-socks#">
                        <li>#양말/스타킹</li>
                    </a>
                    <a href="./stuff-etc#">
                        <li>#기타</li>
                    </a>
                </ul>
                <h3 style="font-size:20px">패션잡화#가방</h3>
            </div>
        </div>
        <div class="outer-select-wrap">
            <div class="outer-select">
                <div class="outer-all">
                    <a href="#">전체(<span id="totalCount">0</span>)</a>
                    <select id="sortOptions">
                        <option value="recommended">추천수</option>
                        <option value="newest">신상품순</option>
                        <option value="price-low">낮은가격순</option>
                        <option value="price-high">높은가격순</option>
                        <option value="name">상품명순</option>
                    </select>
                </div>
            </div>
            <table id="stuff-results">
                <tbody>
                <th:block th:if="${items != null}">
                    <th:block th:each="item, itemStat : ${items.content}">
                        <tr th:class="${itemStat.index >= 12} ? 'hidden' : ''">
                            <td>
                                <div class="container-outer">
                                    <a th:href="'/item/'+${item.id}">
                                        <img th:src="${item.imgUrl}" id="project-img" width="345" height="345"
                                             onmouseover="this.th:src='../img/special/bra2.jpg';"
                                             onmouseout="this.th:src='../img/special/bra.jpg';">
                                        <div class="overlay">
                                            <p class="overlay-text" style="left: 50%; top: 20%;">Merle Bleu</p>
                                            <p class="outer text-outer">
                                                <a th:href="'/item/'+${item.id}">[[${item.itemNm}]]</a>
                                            </p>
                                            <p class="line-through" style="text-decoration: line-through; color: #ccc; left: 10%;">
                                                [[${item.listprice}]]원
                                            </p>
                                            <p class="price" style="left: 40%;">[[${item.sellprice}]]원</p>
                                            <p class="discount" style="color: red; left: 70%;">[[${item.discount}]]%</p>
                                            <div class="overlay2">
                                                <a th:href="'/item/'+${item.id}">
                                                    <p class="color-box"></p>
                                                </a>
                                                <a th:href="'/item/'+${item.id}">
                                                    <p class="color-box2"></p>
                                                </a>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </th:block>
                </th:block>
                </tbody>
            </table>
        </div>
        <div class="my-btn" style="margin-top: -50px;">
            <p id="error2" class="error">마지막 페이지 입니다.</p>
            <button onclick="myFunction()" id="myBtn2">MORE</button>
        </div>
    </div>
</div>
<div th:replace="~{fragments/footer::footer}"></div>
<script>

    // function handleSearch() {
    //     const keyword = document.getElementById('searchKeyword2').value;
    //     if (keyword) {
    //         window.location.href = window.location.pathname + '?keyword=' + encodeURIComponent(keyword);
    //     }
    // }

    // URL에서 검색어 파라미터 가져오기
    const urlParams = new URLSearchParams(window.location.search);
    const keyword = urlParams.get('keyword');

    // 검색어가 포함된 아이템만 표시
    const tableRows = document.querySelectorAll('#stuff-results tbody tr');
    if (keyword) {
        tableRows.forEach(row => {
            const itemText = row.innerText.toLowerCase();
            if (!itemText.includes(keyword.toLowerCase())) {
                row.style.display = 'none';
            }
        });
    }


     // const productsPerPage = 10; // 한 번에 보여줄 상품 수
const productsPerPage = 10; // 한 번에 보여줄 상품 수
let currentIndex = 0;

function myFunction() {
const hiddenRows = document.querySelectorAll('#stuff-results tbody.hidden');
const errorText = document.getElementById("error2");
const btnText = document.getElementById("myBtn2");

// 모든 히든 상품을 보여줌
hiddenRows.forEach(row => {
    row.classList.remove('hidden');
});

// 에러 텍스트 표시
errorText.style.display = 'block';
// 버튼 비활성화
btnText.disabled = true;

// 새로운 상품이 로드될 때마다 전체 수량 업데이트
updateTotalCount();
}

const sortOptions = document.getElementById('sortOptions');
const totalCount = document.getElementById('totalCount');

function getProductsFromHTML(includeHidden = false) {
const tbodyElements = document.querySelectorAll('#stuff-results tbody');
const products = [];
tbodyElements.forEach((element, index) => {
    const imgElement = element.querySelector('img');
    const overlayText = element.querySelector('.overlay-text').innerText;
    const outerText = element.querySelector('.outer.text-outer').innerText;
    const lineThroughText = element.querySelector('.line-through').innerText;
    const priceText = element.querySelector('.price').innerText;
    const discountText = element.querySelector('.discount').innerText;

    const product = {
        id: index,
        name: outerText,
        brand: overlayText,
        consumer_price: parseInt(lineThroughText.replace(/[^0-9]/g, ''), 10),
        sell_price: parseInt(priceText.replace(/[^0-9]/g, ''), 10),
        sale: parseInt(discountText.replace(/[^0-9]/g, ''), 10),
        image: imgElement.src,
        imageHover: imgElement.src.replace('.jpg', '2.jpg'), // 호버시 이미지
        rating: Math.random() * 5, // 예제 데이터를 위해 무작위로 설정
        sales: Math.floor(Math.random() * 1000), // 예제 데이터를 위해 무작위로 설정
        date: new Date().toISOString().split('T')[0], // 예제 데이터를 위해 오늘 날짜로 설정
        hidden: element.classList.contains('hidden') // 히든 여부 추가
    };
    if (includeHidden || !product.hidden) {
        products.push(product);
    }
});
return products;
}

function renderProducts(products) {
const productContainer = document.querySelector('#stuff-results');
productContainer.innerHTML = '';
products.forEach(product => {
    const productHTML = `
<tbody class="${product.hidden ? 'hidden' : ''}">
<tr>
    <td>
        <div class="container-outer">
            <a href="#"><img src="${product.image}" width="345" height="345"
                    onmouseover="this.src='${product.imageHover}';"
                    onmouseout="this.src='${product.image}';">
                <div class="overlay">
                    <p class="overlay-text" style="left: 50%; top: 30%;">${product.brand}</p>
                    <p class="outer text-outer"><a href="#">${product.name}</a></p>
                    <p class="line-through" style="text-decoration: line-through; color: #ccc; left: 10%;">${product.consumer_price.toLocaleString()}원</p>
                    <p class="price" style="left: 40%;">${product.sell_price.toLocaleString()}원</p>
                    <p class="discount" style="color: red; left: 70%;">${product.sale}%</p>
                    <div class="overlay2">
                        <a href="#"><p class="color-box"></p></a>
                        <a href="#"><p class="color-box2"></p></a>
                    </div>
                </div>
            </a>
        </div>
    </td>
</tr>
</tbody>`;
    productContainer.innerHTML += productHTML;
});
updateTotalCount();
}

function sortProducts(criteria) {
const products = getProductsFromHTML(true); // 히든 상품 포함
const sortedProducts = [...products];
switch (criteria) {
    case 'recommended':
        sortedProducts.sort((a, b) => b.rating - a.rating);
        break;
    case 'newest':
        sortedProducts.sort((a, b) => new Date(b.date) - new Date(a.date));
        break;
    case 'price-low':
        sortedProducts.sort((a, b) => a.sell_price - b.sell_price);
        break;
    case 'price-high':
        sortedProducts.sort((a, b) => b.sell_price - a.sell_price);
        break;
    case 'name':
        sortedProducts.sort((a, b) => a.name.localeCompare(b.name));
        break;
    default:
        break;
}
renderProducts(sortedProducts);
}

sortOptions.addEventListener('change', (event) => {
const criteria = event.target.value;
sortProducts(criteria);
});

document.addEventListener('DOMContentLoaded', () => {
// 처음 로드할 때 전체 수량 업데이트
updateTotalCount();
});

function updateTotalCount() {
const products = getProductsFromHTML(true); // 히든 상품 포함
totalCount.innerHTML = products.length;
}

// 처음 로드할 때 전체 수량 업데이트
updateTotalCount();
</script>
<script src="/js/js.js" type="text/javascript"></script>
</body>

</html>